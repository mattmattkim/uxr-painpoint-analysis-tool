<!DOCTYPE html>
<html>
<head>
    <title>Stage Mapping Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e5e5;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .api-stage {
            color: #dc2626;
            font-family: monospace;
            background: #fef2f2;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .proper-stage {
            color: #059669;
            font-family: monospace;
            background: #f0fdf4;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .title {
            color: #111827;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Stage ID Mapping Test</h1>
        <p>This shows how underscore-formatted stage IDs from the API are mapped to proper stage titles:</p>
        
        <table>
            <thead>
                <tr>
                    <th>API Stage ID (with underscores)</th>
                    <th>Normalized Stage ID</th>
                    <th>Human-Friendly Title</th>
                </tr>
            </thead>
            <tbody id="mappingTable"></tbody>
        </table>
    </div>

    <script>
        // Simulating the mapping logic from AnalysisModal.tsx
        const lifecycleStages = [
            { id: 'requirements', title: 'Requirements Gathering' },
            { id: 'alignment', title: 'Proposal' },
            { id: 'creation', title: 'Initial SOW Creation' },
            { id: 'review', title: 'Internal Review' },
            { id: 'negotiation', title: 'Negotiation & Revisions' },
            { id: 'signature', title: 'Signature Collection' },
            { id: 'procurement', title: 'Procurement' },
            { id: 'handoff', title: 'Handoff to Delivery' },
            { id: 'tracking', title: 'Project Tracking' },
            { id: 'retrospective', title: 'Retrospective' }
        ];

        const stageMapping = {
            'requirements_gathering': 'requirements',
            'stakeholder_alignment': 'alignment',
            'initial_sow_creation': 'creation',
            'internal_review': 'review',
            'negotiation_revisions': 'negotiation',
            'signature_collection': 'signature',
            'procurement': 'procurement',
            'handoff_to_delivery': 'handoff',
            'project_tracking': 'tracking',
            'retrospective': 'retrospective'
        };

        function normalizeStageId(stageId) {
            return stageMapping[stageId] || stageId;
        }

        function getStageTitle(stageId) {
            const normalizedId = normalizeStageId(stageId);
            const stage = lifecycleStages.find(s => s.id === normalizedId);
            return stage ? stage.title : stageId;
        }

        // Test cases - these are the stage IDs we see in the screenshots
        const testStageIds = [
            'requirements_gathering',
            'initial_sow_creation',
            'signature_collection',
            'procurement',
            'handoff_to_delivery',
            // Also test some that might not have underscores
            'requirements',
            'creation',
            'review'
        ];

        const tableBody = document.getElementById('mappingTable');
        
        testStageIds.forEach(stageId => {
            const row = document.createElement('tr');
            const normalizedId = normalizeStageId(stageId);
            const title = getStageTitle(stageId);
            
            row.innerHTML = `
                <td><span class="api-stage">${stageId}</span></td>
                <td><span class="proper-stage">${normalizedId}</span></td>
                <td><span class="title">${title}</span></td>
            `;
            
            tableBody.appendChild(row);
        });
    </script>
</body>
</html>